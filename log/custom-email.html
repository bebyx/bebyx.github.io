<!doctype html>
<html class="no-js" lang="uk">

	<head>
		<meta charset="utf-8">
		<title>bebyx: Власний емейл</title>
		<meta name="description" content="Новий емейл на власному мейл-сервері.">
		<meta name="author" content="Артем Бебик">
		<meta name="keywords" content="email, server">
		<meta property="article:published_time" content="2021-11-20T20:53:00EET" />

		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="../main.css">
		</head>

	<body>
		<article>

			<header>
				<h1>Власний емейл</h1>
				<small><time datetime="2021-11-20T20:53:00EET">20-11-2021</time></small>
			</header>

			<p>
				Почалося з того, що вирішив перейти на емейл з нормальними практиками приватності.
			</p>

			<p>
				У <a href="https://replace.org.ua/topic/13683/" target="_blank">ході пошуків</a>
				 перебрав усі <a href="https://www.fsf.org/resources/webmail-systems" target="_blank">рекомендації від FSF</a>, добре з'ясував технології <a href="https://uk.wikipedia.org/wiki/PGP" target="
				 ">PGP</a> і роботу зі GnuPG,
				 відкрив для себе <a href="https://www.linode.com/" target="_blank">Linode</a>, запустив там власний мейл-сервер на шифрованому хості,
				 розібрався з деякими деталями мейл-технології <a href="http://www.open-spf.org/FAQ/Examples/" target="_blank">на кшталт spf</a>
				 і загалом дізнався багато цікавого.
			</p>

			<p>
				Сторонні мейл-сервіси як один виявилися неприйнятними для моїх скромних (!) запитів, тож зрештою я довів
				 мейл-сервер на Linode до стану production-ready і лишився тим дуже задоволений.

			</p>

			<h2>Остаточна збірка</h2>

			<p>
				Основні інструкції взяв з
				<a href="https://www.linode.com/docs/guides/email-with-postfix-dovecot-and-mysql/#adding-an-email-address-within-mysql"
				target="_blank">ґайду від Linode</a>.
			</p>

			<p>
				0. <b>Nanode</b>: Debian 11 з диском, зашифрованим LUKS'ом.</br>
				1. <b>MariaDB</b> для сховища.</br>
				2. <b>Postfix</b> як базовий MTA.</br>
				3. <b>Dovecot</b> для IMAP і LMTP.</br>
				4. <b>Spamassassin</b> од спаму.</br>
				5. Зовнішній SMTP від <b>Mailjet</b>, чиї параметри прописую в налаштуваннях самого емейл-клієнта.</br>
				6. Клієнти — <b>Thunderbird</b> на GNU/Linux і <b>K-8</b> на Android.
			</p>

			<p>Якщо не рахувати видатки на доменне ім'я' і DNS, котрі вже давно маю, ціна всього серверу — $5 на місяць.</p>

			<p>Для порівняти: преміум Protonmail Plus, котрий дає змогу прив'язати
				  свій домен, коштує стільки ж, не даючи й близько такої свободи конфігурації.</p>

			<h2>Зауваги</h2>

			<h3>Видатки зовнішнього SMTP</h3>

			<p>
				П.4 збірки має певну незручність, бо <b>відіслані листи</b> не синхронізуються між Thunderbird і K-8.
			</p>

			<p>
				Аби це виправити, варто прив'язати Mailjet прямо до Postfix (Mailjet надає детальну інструкцію).
			</p>

			<p>
				Однак Linode має певні обмеження для вихідних портів SMTP для нових акаунтів, то мушу почекати, перш ніж це пробувати.
				Їхня підтримка сказла, щоби надсилав запит, коли матиму 3 місяці сплат.
			</p>

			<h3>Проблема зі спеціальними символами в паролі</h3>

			<p>
				Мені вдалося встановити все без проблем за наведеною за посиланням вище інструкцією.
			</p>

			<p>
				Єдине, що мусив з'ясувати сам: шифрування паролів од Dovecot не підтримує спеціальних знаків стандартного UTF-8 за замовченням.
			</p>

			<p>
				Розв'язок доволі тривільний: <a href="https://doc.dovecot.org/configuration_manual/authentication/password_schemes/#encoding" target="_blank">користувати кодуванням base64 або hex</a>.
			</p>

			<p>
				Коли генеруєте пароль, то додайте розширення кодування.
			</p>

			<p>
				Для base64:</br>
				<code>sudo doveadm pw -s SHA512-CRYPT.base64 -p "p@$$w0rd" -r 5000` # або .b64</code>
			</p>

			<p>
				Для hex:</br>
				<code>sudo doveadm pw -s SHA512-CRYPT.hex -p "p@$$w0rd" -r 5000</code>
			</p>

			<p>
				Далі, пам'ятайте збільшмити допустиму кількість символів у відповідній клітинці <b>бази даних</b>.
				Наприклад, для b64:</br>
				<code>ALTER TABLE virtual_users MODIFY password VARCHAR(145);</code>
			</p>

			<p>
				<ul>
					<li>105 для дефолту (дає ґайд від Linode)</li>
					<li>145 для b64</li>
					<li>213 для hex</li>
				</ul>
			</p>

			<p>
				І наостанок поставте в файлі <code>/etc/dovecot/dovecot-sql.conf.ext</code>
				 параметр <code>default_pass_scheme</code> відповідно до вашого кодування:
				 <code>SHA512-CRYPT.b64</code> або <code>SHA512-CRYPT.hex</code>.
			</p>

			<p>
				Сподіваюся ця інфа зекономить вам пів дня зневадження.
			</p>

			<h2>Післяслово</h2>

			<p>Сутність технологій електронної пошти — федералізованість.
				Кожен може запустити власний сервер і відравляти повідомлення на скриньки на інших.
			</p>

			</p>
				Як і у випадку зі світовою павутиною, всі мейл-сервери не мають належати кільком ІТ-гігантам.
			</p>
			<p>
				Власний емейл — це маленький крок до децентралізованого Інтернету, яким він і задумувався, і великий крок для своєї цифрової незалежності й самостійності.
			</p>

		</article>
		<nav>
			<a href="/">Повернутися</a>
		</nav>
	</body>

</html>
